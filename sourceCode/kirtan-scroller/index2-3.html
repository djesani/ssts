<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kirtans</title>
    <style>
        body {
            background-color: #fff2e6;
            color: #990101;
            overflow: hidden;
        }

        :root {
            --default-color: #990101;
            --default-opacity: 1;
            --highlight-color: #ff6a00;
            --transition-duration: 500ms;
        }

        #title {
            font-size: 40px;
            text-align: center;
        }

        ul {
            list-style: none;
            padding: 0;
            position: relative;
            width: 100%;
            height: 100vh;
        }

        .list-item {
            padding: 5px 0;
            font-size: 30px;
            width: 100%;
            text-align: center;
            color: var(--default-color);
            font-weight: normal;
            transition: all linear var(--transition-duration);
            position: absolute;
        }

        .list-item.no-animation {
            transition: none;
        }

        .list.grow .list-item,
        .list.shrink .list-item {
            transition: all linear var(--transition-duration);
        }

        .list.grow .list-item:nth-child(1) {
            top: 0vh;
            opacity: 0;
        }

        .list.grow .list-item:nth-child(2) {
            top: 10vh;
            opacity: 0;
        }

        .list.grow .list-item:nth-child(3) {
            top: 30vh;
            opacity: var(--default-opacity);
        }

        .list.grow .list-item:nth-child(4) {
            top: 50vh;
            opacity: 1;
        }

        .list.grow .list-item:nth-child(5) {
            top: 70vh;
            opacity: var(--default-opacity);
        }

        .list.shrink .list-item:nth-child(1) {
            top: 30vh;
            opacity: var(--default-opacity);
        }

        .list.shrink .list-item:nth-child(2) {
            top: 50vh;
            opacity: 1;
        }

        .list.shrink .list-item:nth-child(3) {
            top: 70vh;
            opacity: var(--default-opacity);
        }

        .list.shrink .list-item:nth-child(4) {
            top: 90vh;
            opacity: 0;
        }

        .list.shrink .list-item:nth-child(5) {
            top: 100vh;
            opacity: 0;
        }
    </style>
</head>

<body>
    <h1 id="title"></h1>
    <ul id="list" class="list"></ul>

    <script>
        document.addEventListener('keydown', event => {
            if (event.keyCode === 38) {
                if (index > 0) {
                    prev();
                }
            } else if (event.keyCode === 40) {
                if ((index + 3) < slides.length) {
                    next();
                }
            }
        });

        let kirtanJson, slides, title, index = 0;
        const list = document.getElementById('list');
        const numLines = 3;
        const lineHeightVh = 30; // Adjust as necessary

        async function loadData() {
            const response = await fetch("data.json");
            kirtanJson = await response.json();
            const id = getUrlParamsId();
            const kirtan = getKirtanById(id);
            title = kirtan.title_english;
            slides = kirtan.description_english.split("\n");
            renderTitle();
            renderSlides();
        }

        function renderTitle() {
            document.getElementById('title').innerText = title;
        }

        function getKirtanById(id) {
            return kirtanJson.data.find(x => x.id == id) || kirtanJson.data[0];
        }

        function getUrlParamsId() {
            const urlSearch = new URLSearchParams(window.location.search);
            return urlSearch.get('id') || 1;
        }

        function renderSlides() {
            list.innerHTML = '';
            for (let i = 0; i < numLines; i++) {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.id = `l${i}`;
                li.style.top = `${lineHeightVh * i}vh`;
                li.innerText = slides[index + i - 1] || "";
                list.appendChild(li);
            }
        }

        function prev() {
            transitionSlides('shrink', -1);
        }

        function next() {
            transitionSlides('grow', 1);
        }

        function transitionSlides(animationClass, step) {
            toggleAnimationClasses(false);
            list.classList.add(animationClass);
            setTimeout(() => {
                toggleAnimationClasses(true);
                list.classList.remove(animationClass);
                index += step;
                renderSlides();
            }, 500);
        }

        function toggleAnimationClasses(remove) {
            const method = remove ? 'add' : 'remove';
            document.querySelectorAll('.list-item').forEach(item => {
                item.classList[method]("no-animation");
            });
        }

        function toggleAnimationClasses(remove) {
            const method = remove ? 'add' : 'remove';
            ['l0', 'l1', 'l2', 'l3', 'l4'].forEach(id => {
                document.getElementById(id).classList[method]("no-animation");
            });
        }

        loadData();
    </script>
</body>

</html>
